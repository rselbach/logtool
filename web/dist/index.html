<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Logtool Dashboard</title>
    <link rel="stylesheet" href="./styles.css">
  </head>
  <body>
    <header class="topbar">
      <h1>Logtool</h1>
      <div class="topbar-right">
      <nav class="controls">
        <select id="rangePreset">
          <option value="24h">Last 24 hours</option>
          <option value="7d" selected>Last 7 days</option>
          <option value="2w">Last 2 weeks</option>
          <option value="1m">Last 1 month</option>
          <option value="today">Today</option>
          <option value="duration">Duration…</option>
          <option value="custom">Custom…</option>
        </select>
        <input type="text" id="duration" class="hidden" placeholder="Go duration (e.g. 5m)" aria-label="Duration">
        <input type="datetime-local" id="from" class="hidden">
        <input type="datetime-local" id="to" class="hidden">
        <select id="bucket">
          <option value="auto" selected>Auto bucket</option>
          <option value="minute">Minute</option>
          <option value="hour">Hour</option>
          <option value="day">Day</option>
        </select>
        <select id="hostFilter">
          <option value="">All hosts</option>
        </select>
         <button id="refresh">Live</button>
      </nav>
      <div class="user-badge hidden" id="userBadge" aria-live="polite">
        <button id="userBadgeToggle" class="user-badge-btn" type="button" aria-haspopup="menu" aria-expanded="false">
          <img id="userAvatar" class="user-avatar hidden" alt="" width="32" height="32" decoding="async">
          <span id="userEmail" class="user-email"></span>
          <span class="user-caret" aria-hidden="true">▾</span>
        </button>
        <div id="userMenu" class="user-menu hidden" role="menu">
          <a href="/logout" class="user-menu-item" role="menuitem">Log out</a>
        </div>
      </div>
      </div>
    </header>

    <main class="content">
      <section class="cards" id="summary">
        <div class="card">
          <div class="label">Requests</div>
          <div class="value" id="sumRequests">–</div>
        </div>
        <div class="card">
          <div class="label">Unique Remote</div>
          <div class="value" id="sumUnique">–</div>
        </div>
        <div class="card">
          <div class="label">Errors</div>
          <div class="value" id="sumErrors">–</div>
        </div>
        <div class="card">
          <div class="label">Last Request</div>
          <div class="value small" id="sumLast">–</div>
        </div>
      </section>

      <section class="grid3">
        <div class="panel">
          <div class="panel-header">Requests Over Time</div>
          <div class="chart"><canvas id="chartRequests"></canvas></div>
        </div>
        <div class="panel">
          <div class="panel-header">Errors Over Time</div>
          <div class="chart"><canvas id="chartErrors"></canvas></div>
        </div>
        <div class="panel">
          <div class="panel-header">UA Families (Pie)</div>
          <div class="chart"><canvas id="chartUAFam"></canvas></div>
          <div class="legend" id="legendUAFam"></div>
        </div>
      </section>

      <section class="grid2">
        <div class="panel">
          <div class="panel-header">Hosts by Traffic</div>
          <div class="chart"><canvas id="chartHosts"></canvas></div>
          <div class="legend" id="legendHosts"></div>
        </div>
        <div class="panel">
          <div class="panel-header">Top Hosts</div>
          <table class="table" id="hostsTable"><thead><tr>
            <th class="sortable" data-key="host">Host</th>
            <th class="num sortable" data-key="count">Count</th>
            <th class="num sortable" data-key="pct">%</th>
          </tr></thead><tbody></tbody></table>
        </div>
      </section>

      <section class="grid2">
        <div class="panel">
          <div class="panel-header">Top Paths</div>
          <table class="table" id="topPaths"><thead><tr>
            <th class="sortable" data-key="path">Path</th>
            <th class="num sortable" data-key="count">Count</th>
          </tr></thead><tbody></tbody></table>
        </div>
        <div class="panel">
          <div class="panel-header">Top Referrers</div>
          <table class="table" id="topRef"><thead><tr>
            <th class="sortable" data-key="referrer">Referrer</th>
            <th class="num sortable" data-key="count">Count</th>
          </tr></thead><tbody></tbody></table>
        </div>
      </section>

      <section class="grid2">
        <div class="panel">
          <div class="panel-header">UA Families</div>
          <table class="table" id="uaFamilies"><thead><tr>
            <th class="sortable" data-key="family">Family</th>
            <th class="num sortable" data-key="count">Count</th>
            <th class="num sortable" data-key="pct">%</th>
          </tr></thead><tbody></tbody></table>
        </div>
        <div class="panel">
          <div class="panel-header">Top User Agents</div>
          <table class="table" id="uaTop"><thead><tr>
            <th class="sortable" data-key="ua">User Agent</th>
            <th class="num sortable" data-key="count">Count</th>
          </tr></thead><tbody></tbody></table>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">Status Breakdown</div>
        <table class="table" id="statusTbl"><thead><tr>
          <th class="sortable" data-key="status">Status</th>
          <th class="num sortable" data-key="count">Count</th>
        </tr></thead><tbody></tbody></table>
      </section>

      <section class="panel">
        <div class="panel-header">Recent Requests</div>
        <table class="table" id="reqTbl"><thead><tr>
          <th>Time</th><th>Remote</th><th>Method</th><th>Path</th><th>Status</th><th class="num">Bytes</th><th>Referer</th><th>User-Agent</th>
        </tr></thead><tbody></tbody></table>
      </section>

      <section class="panel">
        <div class="panel-header">Recent Errors</div>
        <table class="table" id="errorsTbl"><thead><tr><th>Time</th><th>Level</th><th>PID</th><th>TID</th><th>Message</th></tr></thead><tbody></tbody></table>
      </section>
    </main>

    <footer class="foot">Built with Logtool</footer>
    <script src="./vendor/chart.umd.min.js"></script>
    <script src="./app.js"></script>
  </body>
  </html>
